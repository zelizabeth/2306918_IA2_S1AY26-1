<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
</head>
<body>
    <header class="carthead">
        <h1>Your Cart</h1>
        <nav>
            <!--Continue shopping option-->
            <a href="Product.html" class="toproduct"><i class="material-icons">arrow_circle_left</i> Continue Shopping</a>
        </nav>
    </header>
    <section class="cart">
        <div id="cart_products">
            <!--items added to cart, qty, remove buttons-->
        </div>
        
        <div id="proceed">
            <h1>Checkout</h1>
            <div id="subtotal">
                <!--subtotal, discount and taxes appear here-->
            </div>
            <br>
            <!--Proceed to checkout button-->
            <a href="Checkout.html"><button id="checkoutBtn">Proceed to Checkout</button></a>  
        </div>
    </section>


    <script>
        const cartItems = JSON.parse(localStorage.getItem('mycart')) || [];
        const cart_list = document.getElementById('cart_products');
        
        if(cartItems.length === 0){
            cart_list.innerHTML = '<h3>Your cart is empty, continue shopping.</h3>';
        }else{
            cartItems.forEach((product, index) => {
                const productitem = document.createElement('div');
                productitem.innerHTML = `
                    <div class="cart_items">
                    <img src="../Assets/${product.image}" alt="${product.name}" class="cartimg" width="100">
                    <br>
                    <div>
                        <h3>${product.name}</h3><br>
                        <h5>Price: $${product.price}</h5><br>
                        Quantity: <input type="number" min="1" class="qty" data-index=${index} value="${product.quantity}"><br>
                        ${product.color ? `Color: ${product.color}<br><br>` : '<br>'}
                        <button class="remove" data-index="${index}"">Remove</button>
                    </div>
                    </div>    
                    <br>  
                    <hr>              
                
                `;
                cart_list.appendChild(productitem);
            });

            //calculate subtotal, discount, tax and total
            const discount = 0.05; //fixed discount
            const tax = 0.15; //fixed tax
            let subtotal = 0;
            cartItems.forEach((product) => {
                subtotal += product.price * product.quantity;
            });
            let discountamt = discount * subtotal;
            let taxamt = tax * (subtotal-discountamt);
            document.getElementById('subtotal').innerHTML = 
            `<h3>Subtotal: $${subtotal.toFixed(2)}</h3>
            <h4>Discount: $${discountamt.toFixed(2)}</h4>
            <h4>Tax: $${taxamt.toFixed(2)}</h4>
            <hr>
            <h2>Total: $${((subtotal - discountamt)+taxamt).toFixed(2)}</h2>`;
            
        }

        const remove = document.querySelectorAll('.remove');
        remove.forEach(button =>{
            button.addEventListener('click', (e) => {
                const productIndex = e.target.getAttribute('data-index');
                //remove item from array
                cartItems.splice(productIndex, 1);
                //save updated array back to localStorage
                localStorage.setItem('mycart', JSON.stringify(cartItems));
                //reload the page
                location.reload();
            });
        })

        // Select all quantity inputs
        const qty = document.querySelectorAll('.qty');

        qty.forEach(input => {
            input.addEventListener('change', (e) => {
                const index = e.target.getAttribute('data-index');
                const newQty = parseInt(e.target.value);

                // Update the array
                cartItems[index].quantity = newQty;

                // Save updated array back to localStorage
                localStorage.setItem('mycart', JSON.stringify(cartItems));
                location.reload();
            });
        });

    </script>
    
</body>
</html>